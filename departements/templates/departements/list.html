{% extends 'base.html' %}


{% block main %}

<div class="xl:w-5/6 mx-auto glass overflow-x-auto shadow-md rounded p-6 min-h-fit">
  <h1 class="text-2xl font-bold mb-6 inline-block dark:text-white">Liste des départements</h1>
  {% if "departements.add_departements" in permissions %}
  <a class="btn btn-info" href="{% url 'departement_add' %}">Ajouter</a>
  {% endif %}

  <table class="table glass w-full min-w-full text-black dark:text-white ">
    <thead class="table-header-group">
      <tr class="dark:text-white border-b-2 text-black">
        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Nom</th>
        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Créé par</th>
        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Date de création</th>
        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Date de mise à jour
        </th>
        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Mis à jour par</th>
        <th></th>
      </tr>
    </thead>
    <tbody class="">
      {% for departement in departements %}
      <tr class="">
        <td class="px-6 py-4 whitespace-nowrap">{{ departement.name }}</td>
        <td class="px-6 py-4 whitespace-nowrap">{{ departement.created_by.username }}</td>
        <td class="px-6 py-4 whitespace-nowrap">{{ departement.created_at|date:"d/m/Y" }}</td>
        <td class="px-6 py-4 whitespace-nowrap">{{ departement.updated_at|date:"d/m/Y" }}</td>
        <td class="px-6 py-4 whitespace-nowrap">
          {% if departement.created_by == request.user %}
          myself
          {% else %}
          {{ departement.created_by.username }}
          {% endif %}
        </td>

        <td class="dropdown dropdown-bottom">
          <label tabindex=0 class="btn m-1">Actions</label>
          <ul tabindex=0
            class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52 flrx flex-col gap-2">
            <li>
              <a href="{% url 'departements_delete' departement.pk %} " class="btn btn-error">Supprimer</a>
            </li>
            <li>
              <a href="{% url 'departements_update' departement.pk %} " class="btn btn-warning">Modifier</a>
            </li>
            <li>
              <a href="{% url 'departements_profil' departement.pk %} " class="btn btn-info">Detail</a>
            </li>
          </ul>
        </td>

      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="px-6 py-4 text-center text-red-500 text-2xl">Aucun département trouvé.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pagination simple -->
  {% if is_paginated %}
  <div class="mt-4 flex justify-center space-x-2">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}"
      class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400">Précédent</a>
    {% endif %}

    <span class="px-3 py-1">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400">Suivant</a>
    {% endif %}
  </div>
  {% endif %}
</div>

{% endblock main %}